@model Model.OutModel.Insert

@{
    ViewData["Title"] = "Inserts";
}



<h2>新增出货</h2>

<script src="~/layuiadmin/layui/layui.js"></script>
<link href="~/layuiadmin/layui/css/layui.css" rel="stylesheet" />

<div class="layui-colla-content layui-show">
    <div class="layui-inline" style="margin-top:10px">
        <label class="layui-label">客户：</label>
    </div>
    <div class="layui-inline">
        <input type="text" placeholder="请查询客户名称" id="client" style="width:150px" class="layui-input" />
    </div>
    <div class="layui-inline" style="margin-left:20px">
        <select id="xiao" class="layui-select">
        </select>
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:50px">
        <label class="layui-label">单据日期：</label>
    </div>
    <div class="layui-inline">
        <input type="date" id="date" class="layui-input" />
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:50px">
        <label class="layui-label">单据编号：</label>
    </div>
    <div class="layui-inline">
        <span id="bian"></span>
    </div>


    <div class="layui-inline">
        <button type="button" class="layui-btn layui-btn-radius" id="Cha">查询结果</button>
    </div>

</div>


<table id="tb" class="table table-bordered">
    <tr>
        <td>商品</td>
        <td>单位</td>
        <td>仓库（批量）</td>
        <td>数量</td>
        <td>销售单价</td>
        <td>折扣率（%）</td>
        <td>折扣额</td>
        <td>销售金额</td>
        <td>操作</td>
    </tr>

</table>

<input type="hidden" id="allMoney"/>
<input type="hidden" id="realMoney" />
<h4>Insert</h4>
<hr />

<div class="layui-colla-content layui-show">
    <div class="layui-inline" style="margin-top:10px">
        <label class="layui-label">客户：</label>
    </div>
    <div class="layui-inline">
        <input id="CliName" class="layui-input" type="text" style="width:100px" />
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:50px">
        <label class="layui-label">销售人员：</label>
    </div>
    <div class="layui-inline">
        <input id="MName" class="layui-input"  type="text" style="width:100px" />
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:50px">
        <label class="layui-label">商品名称：</label>
    </div>
    <div class="layui-inline">
        <select id="Sid" class="layui-select">
        </select>
    </div>
</div>

<div class="layui-colla-content layui-show">
    <div class="layui-inline" style="margin-top:10px">
        <label class="layui-label">数量：</label>
    </div>
    <div class="layui-inline">
        <input id="Number" class="layui-input"  type="text" style="width:100px" />
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:75px">
        <label class="layui-label">价格：</label>
    </div>
    <div class="layui-inline">
        <input id="SellMoney" class="layui-input"  type="text" style="width:100px"/>
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:60px">
        <label class="layui-label">折扣率：</label>
    </div>
    <div class="layui-inline">
        <input id="Rate" class="layui-input"  type="text" style="width:100px" />
    </div>
</div>

<div class="layui-colla-content layui-show">
    <div class="layui-inline" style="margin-top:10px">
        <label class="layui-label">折扣额：</label>
    </div>
    <div class="layui-inline">
        <input id="Discount" class="layui-input"  type="text" disabled />
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:100px">
        <label class="layui-label">优惠后金额：</label>
    </div>
    <div class="layui-inline">
        <input id="SMoney" class="layui-input"  type="text" disabled />
    </div>
</div>

<div class="layui-colla-content layui-show">
    <div class="layui-inline" style="margin-top:10px">
        <label class="layui-label">地址：</label>
    </div>
    <div class="layui-inline">
        <input id="Addresses" class="layui-input"  type="text" style="width:200px" />
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:50px">
        <label class="layui-label">添加时间：</label>
    </div>
    <div class="layui-inline">
        <input id="CTime" class="layui-input"  type="date" style="width:200px" />
    </div>

    <div class="layui-inline" style="margin-top:10px;margin-left:50px">
        <label class="layui-label">结算账户：</label>
    </div>
    <div class="layui-inline">
        <select id="AId" class="layui-select">
        </select>
    </div>
</div>

<div class="layui-colla-content layui-show">
    <input type="button" value="添加出货" id="insert" class="btn btn-primary" />
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>


<script src="~/lib/jquery/dist/jquery.js"></script>


<script>
    $(function () {


        var myDate = new Date();

        var year = myDate.getFullYear();        //获取当前年
        var month = myDate.getMonth() + 1;   //获取当前月
        var date = myDate.getDate();            //获取当前日


        //var h = myDate.getHours();              //获取当前小时数(0-23)
        //var m = myDate.getMinutes();          //获取当前分钟数(0-59)
        //var s = myDate.getSeconds();
        //+ getNow(h) + getNow(m) + getNow(s)
        var dd = Math.floor(Math.random() * 10000)
        //out = Math.floor(Math.random() * 10000);


        var now = year + getNow(month) + getNow(date)+dd;
        $("#bian").html("CH" + now)
        

        Xiao();
        Pay();
        Commind();
       
    })

    function Xiao() {

        $.ajax({
            url: "https://localhost:44300/api/showXiao",
            type: "get",
            dataType: "json",
            success: function (result) {
                $("#xiao").empty();
                var str = "";
                str += "<option value='-1'>销售人员</option>"
                $.each(result, function (i, n) {
                    str += "<option value='" + n.seId + "' >" + n.seName + "</option>"
                })
                $("#xiao").append(str);

                Show();
            }
        })

    }
    function Pay() {

        $.ajax({
            url: "https://localhost:44300/api/showPay",
            type: "get",
            dataType: "json",          
            success: function (result) {
                $("#AId").empty();
                var str = "";
                str += "<option value='-1'>请选择结算账户</option>"
                $.each(result, function (i, n) {
                    str += "<option value='" + n.aId + "' >" + n.accountName + "</option>"
                })
                $("#AId").append(str);

            }
        })

    }
   

    function Commind() {

        $.ajax({
            url: "https://localhost:44300/api/showCommind",
            type: "get",
            dataType: "json",
            success: function (result) {
                $("#Sid").empty();
                var str = "";
                str += "<option value='-1'>请选择商品</option>"
                $.each(result, function (i, n) {
                    str += "<option value='" + n.sid + "' >" + n.sName + "</option>"
                })
                $("#Sid").append(str);

            }
        })

    }

    function Show() {
        var client = $("#client").val();
        var xiao = parseInt($("#xiao").val());
        var date = $("#date").val();

        $.ajax({
            url: "https://localhost:44300/api/showIns?client=" + client + "&xiao=" + xiao + "&date=" + date,
            type: "get",
            dataType: "json",
            success: function (result) {
                ShowList(result)

            }
        })

    }


    function ShowList(result) {
        var str = "";

        $("#tb tr:gt(0)").empty();
        $.each(result, function (i, n) {

            str += "<tr><td>" + n.sName + "</td>";
            str += "<td>" + n.units + "</td>";
            str += "<td>" + n.wName + "</td>";
            str += "<td>" + n.number + "</td>";
            str += "<td>" + n.sellMoney + "</td>";
            str += "<td>" + n.rate + "</td>";
            str += "<td>" + (n.number * n.sellMoney * n.rate) + "</td>";
            str += "<td>" + n.sMoney + "</td>";

            str += "<td><a href='javascript: Shan(" + n.clearId + ")'>删除|</a><a href='javascript: Xiu(" + n.clearId + ")'>修改|</a>  </td ></tr> ";

        })
        $("#tb").append(str);

    }
    $("#Cha").click(function () {
        Show();
    })

    $("#insert").click(function () {
        list = {};
        list.CleaNumber = $("#bian").html();
        list.CliName = $("#CliName").val();
        list.MName = $("#MName").val();
        list.SName = $("#SName").val();
        list.Sid = parseInt($("#Sid").val());
        list.Number = parseInt($("#Number").val());
        list.SellMoney = parseFloat($("#SellMoney").val());
        list.Rate = parseFloat($("#Rate").val());
        list.Discount = parseFloat($("#Discount").val())
        list.SMoney = parseFloat($("#SMoney").val());
        list.Addresses = $("#Addresses").val();
        list.CTime = $("#CTime").val();
        list.AId = parseInt( $("#AId").val());        
       
        $.ajax({
            url: "https://localhost:44300/api/insert",
            data: JSON.stringify(list),
            type: "post",
            dataType: "text",
            contentType:"application/json",
            success: function (result) {
                if (result > 0) {
                    alert("添加成功")

                }
            }
        })
        
    })
    $("#Rate").change(function () {
        change();
    });
    $("#SellMoney").change(function () {
        change();
    })
    $("#Number").change(function () {
        change();
    })

    function change() {
        $("#allMoney").val(parseInt($("#Number").val()) * parseFloat($("#SellMoney").val()))
        $("#realMoney").val(parseInt($("#Number").val()) * parseFloat($("#SellMoney").val()) * parseFloat($("#Rate").val()))
        $("#Discount").val($("#allMoney").val() * $("#Rate").val())
        $("#SMoney").val($("#allMoney").val() - $("#allMoney").val() * $("#Rate").val())

    }


   
   


    function loadMoney() {
        

    }


    function Shan(id) {



    }
    function Xiu(id) {


    }

    //判断是否在前面加0
    function getNow(s) {
        return s < 10 ? '0' + s : s;
    }





</script>














