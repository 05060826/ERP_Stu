
@{
    Layout = null;
}
<script src="~/layuiadmin/layui/layui.js"></script>
<link href="~/layuiadmin/layui/css/layui.css" rel="stylesheet" />
<script src="~/lib/jquery/dist/jquery.js"></script>
<!DOCTYPE html>

<div class="layui-collapse">
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">筛选查询</h2>
        <div class="layui-colla-content layui-show">
            <div class="layui-input-inline">
                <input type="text" id="ReceiptCode" required lay-verify="required" placeholder="请输入单据号" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline">
                <input type="text" id="Cname" required lay-verify="required" placeholder="请输入调入仓库" autocomplete="off" class="layui-input" />
            </div>
            <div class="layui-input-inline">
                <input type="text" id="Rname" required lay-verify="required" placeholder="请输入调出仓库" autocomplete="off" class="layui-input"/> 
            </div>
            <div class="layui-inline">
                <button class="layui-btn" lay-submit lay-filter="formDemo" id="btnselect">查询结果</button>
            </div>
        </div>
    </div>
</div>
<div class="layui-inline" style="width:115px;float:right">
    <button class="layui-btn" lay-submit lay-filter="formDemo" id="btnAdd">新增调拨单</button>
</div>
<div class="layui-form">
    <table class="layui-hide" id="test" lay-filter="test"></table>
</div>


<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>


<script>
    //注意：折叠面板 依赖 element 模块，否则无法进行功能性操作
    layui.use('element', function () {
        var element = layui.element;
    });

    layui.use(['form', 'layer'], function () {
        var form = layui.form;
        form.render(); //渲染页面
    });

    $(function () {
        var where = $("#ReceiptCode").val();
        var WName = $("#Cname").val()
        var Ename = $("#Rname").val()
        GetReceiptData(where, WName, Ename);
        $("#btnselect").click(function () {
            var where = $("#ReceiptCode").val();
            var WName = $("#Cname").val()
            var Ename = $("#Rname").val()
            GetReceiptData(where, WName, Ename);
        });
        $("#btnAdd").click(function () {
            window.location.href = "/Allot/CreateAllot";
        })
    })
    //显示数据
    function GetReceiptData(where, WName, Ename) {
        layui.use('table', function () {
            var table = layui.table;

            table.render({
                elem: '#test'
                , url: "http://49.234.34.192:7086/api/Allot/ShowPageAllot?AllotCode=" + where + "&&WName=" + WName + "&&Ename=" + Ename+''
                , title: '调拨页面'
                , totalRow: true
                , cols: [[
                    { type: 'checkbox', fixed: 'left' }
                    , { field: 'ATime', title: '单据日期', width: 150, edit: 'text' }
                    , { field: 'AllotCode', title: '单据编号', width: 150, edit: 'text' }
                    , { field: 'SName', title: '商品名称', width: 150, sort: true, totalRow: true }
                    , { field: 'Number', title: '数量', width: 150, edit: 'text', sort: true }
                    , { field: 'Units', title: '单位', width: 150, sort: true, totalRow: true }
                    , { field: 'WName', title: '调出仓库', width: 150 }
                    , { field: 'Ename', title: '调入仓库', width: 150 }
                    , { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 150 }
                ]]
                , done: function () {
                    $("[data-field='AllotId']").css('display', 'none');
                }
                , page: true
            });
        });
    }
    layui.use('table', function () {
        var table = layui.table;
        table.on('tool(test)', function (obj) {
            var data = obj.data;
            if (obj.event === 'del') {
                layer.confirm('确定要删除嘛?', function (index) {
                    $.ajax({
                        url: "http://49.234.34.192:7086/api/Allot/Update?Id=" + obj.data.AllotId + "",
                        type: "get",
                        dataType: "text",
                        success: function (result) {
                            if (result > 0) {
                                alert("删除成功");
                                GetReceiptData(where, WName, Ename);
                            }
                            else {
                                alert("删除失败");
                                GetReceiptData(where, WName, Ename);
                            }
                        }
                    });
                });
            } 
        });
    });
</script>


